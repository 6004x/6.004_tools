<!DOCTYPE html>
<html lang="en">
    <head>
        <title>ui test</title>
        <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.2/jquery.min.js"></script>
        <script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.4.4/underscore-min.js"></script>
        <script src="http://cdnjs.cloudflare.com/ajax/libs/backbone.js/1.0.0/backbone-min.js"></script>
        <link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
        <script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>

        <link rel="stylesheet" type="text/css" href="../fileSystem/folders.css">    
        <script src='../fileSystem/fileSystem.js'></script>
        <script src='../fileSystem/folders.js'></script>
        <script src='TapeList.js'></script>
        <script src='TSM.js'></script>
        <script src='TMSIM.js'></script>
        <script src='split_ui.js'></script>
        <!-- importing editor by mattpf -->
            <script src="../editor/toolbar.js"></script>
            <script src="../editor/editor.js"></script>
            <script src="../editor/prompt.js"></script>
            <script src="../editor/external/codemirror.js"></script>
            <script src="../editor/editor.js"></script>
            <script src="../editor/external/codemirror-extensions.js"></script>
            <script src="../editor/modes/uasm.js"></script>
            <script src="../editor/modes/tsim.js"></script>
            <script src="../editor/modes/jsim.js"></script>
            <link rel="stylesheet" type="text/css" href="http://cdnjs.cloudflare.com/ajax/libs/codemirror/3.12.0/codemirror.min.css">
            <link rel="stylesheet" type="text/css" href="../editor/external/codemirror-extensions.css">

    </head>
    <script>
    $(document).ready(function(){
        FileSystem.setup('antonio', 'http://18.62.29.122:8080');

            var mode='tsim';
            editor = new Editor('.span9',mode);
            var set_height = function() {
                editor.setHeight(document.documentElement.clientHeight - 70); // Set height to window height minus title.
            }
            set_height();
            $(window).resize(set_height);


            Folders.setup('.span3', editor, mode);

            Folders.refresh();
            editor.addButtonGroup([new ToolbarButton('TMSim assemble', tmsimAssemble, '')])
            
            function tmsimAssemble(){
                var file=new Object();
                file.name=editor.currentTab();
                file.data=editor.content();
                var tmsim = new TMSIM();
                if(file.name){
                    try{
                        var parsedDict = tmsim.parse(file.data);
                        console.log(typeof parsedDict)
                        // editor.openTab(file.name+'parsed', JSON.stringify(parsedDict), true);
                        tmsim.flattenMachine(parsedDict);
                        var results = tmsim.getResults();
                        editor.openTab(file.name+'tsmed', results, true);
                    } catch(e){
                        editor.clearErrors();
                        for (var i = 0; i < e.length; i++)
                            editor.markErrorLine(file.name, e[i].message, e[i].lineNumber);
                    }
                }
            }
    });
    </script>
    <body>

        <div class="container container-fluid">
            <div class="masthead">
                <ul class="pull-right nav nav-pills">
                    <li class="active" id="maximise_editor"><a>Editor</a></li>
                    <li id="split_pane"><a>Split</a></li>
                    <li id="maximise_simulation"><a>Simulation</a></li>
                </ul>
                <h1>TMSIM</h1>
            </div>
            <div class='row row-fluid'>
                <div class="span3"></div>
                <div class="span9"></div>
            </div>
        </div>
    </body>
</html>